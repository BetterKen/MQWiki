# 3 Lucene倒排索引

## 3.1 介绍

**Lucene是Apache软件基金会中一个开放源代码的全文搜索引擎工具包，是一个全文搜索引擎的架构，提供了完整的查询引擎和索引引擎，部分文本分析引擎**。Lucene的目的是为软件开发人员提供一个简单易用的工具包，以方便在目标系统中实现全文检索的功能，或者是以此为基础建立起完整的全文搜索引擎。

## 3.2 倒排索引

倒排索引源于实际应用中需要根据属性的值来查找记录。这种索引表中的每一项都包括一个属性值和具有该属性值的各记录的地址。**由于不是由记录来确定属性值，而是由属性值来确定记录的位置，因而称为倒排索引(inverted index)**。带有倒排索引的文件我们称为倒排索引文件，简称倒排文件(inverted file)

**倒排索引中的索引对象是文档或者文档集合中的单词等**，用来存储这些单词在一个文档或者一组文档中的存储位置，是对文档或者文档集合的一种最常用的索引机制.

**搜索引擎的关键步骤就是建立倒排索引，倒排索引一般表示为一个关键词，然后是它的频度(出现的次数)、位置**(出现在哪一篇文章或网页中，及有关的日期，作者等信息)，好比一本书的目录、标签一般，读者想看哪一个主题相关的章节，直接根据目录即可找到相关的页面.不必再从书的第一页到最后一页，一页一页地查找.

下面用例子介绍该结构及相应的生成算法° 假设有两篇文章1和文章2.

文章 1 的内容为：Tom lives in Guangzhou,! live in Guangzhou too.

文章 2 的内容为：He once lived in Shanghai.

## 3.3 取得关键字

首先会进行一遍过滤,一般过滤的方式如下:

- **时态的转换**
- **单复数的转换**
- **同义词的转换**
- **大小写的转换**
- **删除没有实际意义的词**

最后得到的处理结果如下:

```
文章1的所有关键词为：[tom] [live] [guangzhou] [i] [live] [guangzhou]
文章2的所有关键词为：[he] [live] [shanghai]
```

## 3.4 建立倒排索引

**我们注意到关键字是按字符顺序排列的（Lucene没有使用B树结构），因此Lucene可以用二元搜索算法快速定位关键词。**

![](http://dist415.oss-cn-beijing.aliyuncs.com/essort.png)

## 3.5 实现

实现时,Lucene将上面三列分别作为**词典文件(TermDictionary),频率文件(frequencies)、位置文件(positions)**保存。其中词典文件不仅保存了每个关键词，还保留了指向频率文件和位置文件的指针，通过指针可以找到该关键字的频率信息和位置信息。



## 3.6 压缩算法

为了减小索引文件的大小，Lucene对索引还使用了压缩技术

首先，**对词典文件中的关键词进行了压缩**，关键词压缩为＜前缀长度.后缀＞，例如:当前词为“阿拉伯语”，上一个词为“阿拉伯”，那么“阿拉伯语”压缩为＜3,语＞
其次大量用到的是对数字的压缩，数字只保存与上一个值的差值（这样可以减少数字的长度，进而减少保存该数字需要的字节数）。例如当前文章号是16389 （不压缩要用3个字节保存）.上一文章号是16382,压缩后保存7（只用一个字节）